{% load static %}
<!-- Navbar del cliente - Solo contenido -->
<nav class="navbar-custom">
    <div class="navbar-container">
        <!-- Logo y marca -->
        <a href="{% url 'vistacliente' %}" class="navbar-brand-custom">
            <img src="{% static 'icon/7.ico' %}" alt="Stefa's Donuts">
        </a>

        <!-- Toggle button para móvil -->
        <button class="navbar-toggle" id="navbarToggle" type="button">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Menú de navegación -->
        <ul class="navbar-nav-custom" id="navbarNav">
            <li class="nav-item-custom">
                <a href="{% url 'vistacliente' %}" class="nav-link-custom">
                    <i class="fas fa-home"></i>
                    Inicio
                </a>
            </li>
            <li class="nav-item-custom">
                <a href="{% url 'catalogocliente' %}" class="nav-link-custom">
                    <i class="fas fa-cookie-bite"></i>
                    Catálogo
                </a>
            </li>
            <li class="nav-item-custom">
                <a href="{% url 'nosotroscliente' %}" class="nav-link-custom">
                    <i class="fas fa-users"></i>
                    Nosotros
                </a>
            </li>

            <!-- Dropdown del perfil -->
            <li class="nav-item-custom dropdown-custom">
                <button class="nav-link-custom dropdown-toggle-custom" type="button">
                    <i class="fas fa-user"></i>
                    Perfil
                    <img src="{% static 'icon/perfil.png' %}" alt="Perfil" class="profile-icon">
                </button>                <div class="dropdown-menu-custom">
                    <a href="{% url 'perfilcliente' %}" class="dropdown-item-custom">
                        <i class="fas fa-user-edit"></i>
                        Mi Perfil
                    </a>
                    {% comment %}
                    <a href="{% url 'historialcompras' %}" class="dropdown-item-custom">
                        <i class="fas fa-history"></i>
                        Mis Compras
                    </a>
                    {% endcomment %}
                    <div class="dropdown-divider-custom"></div>
                    <a href="{% url 'logout' %}" class="dropdown-item-custom">
                        <i class="fas fa-sign-out-alt"></i>
                        Cerrar Sesión
                    </a>
                </div>
            </li>

            <!-- Carrito -->
            <li class="nav-item-custom">
                <div class="cart-container">
                    <div class="carrito" id="carrito">
                        <img src="{% static 'icon/carrito.png' %}" alt="Carrito">
                        <h1>CARRITO</h1>
                        <div class="count-products" id="contador-productos">
                            <span id="contador-productos-numero">0</span>
                        </div>
                    </div>

                    <!-- Panel del carrito -->
                    <div class="container-cart-products" id="container-cart-products">
                        <div class="row-product" id="row-product">
                            <!-- Los productos se cargarán aquí dinámicamente -->
                        </div>

                        <div class="container-general">
                            <div class="cart-total">
                                <h3>Total:</h3>
                                <span class="total-pagar" id="total-pagar">$0.00</span>
                            </div>
                            <button class="botonPagar" id="btn-pagar">PAGAR</button>
                        </div>
                    </div>
                </div>
            </li>
        </ul>
    </div>
</nav>

<!-- Navegación móvil -->
<nav class="mobile-nav" id="mobileNav">
    <div class="mobile-nav-item">
        <a href="{% url 'vistacliente' %}" class="mobile-nav-link">
            <i class="fas fa-home"></i>
            Inicio
        </a>
    </div>
    <div class="mobile-nav-item">
        <a href="{% url 'catalogocliente' %}" class="mobile-nav-link">
            <i class="fas fa-cookie-bite"></i>
            Catálogo
        </a>
    </div>
    <div class="mobile-nav-item">
        <a href="{% url 'nosotroscliente' %}" class="mobile-nav-link">
            <i class="fas fa-users"></i>
            Nosotros
        </a>
    </div>
    <div class="mobile-nav-item">
        <a href="{% url 'perfilcliente' %}" class="mobile-nav-link">
            <i class="fas fa-user"></i>
            Perfil
        </a>
    </div>
    <div class="mobile-nav-item">
        <a href="{% url 'logout' %}" class="mobile-nav-link">
            <i class="fas fa-sign-out-alt"></i>
            Cerrar Sesión
        </a>
    </div>
</nav>

<!-- Overlay para móvil -->
<div class="mobile-overlay" id="mobileOverlay"></div>

<style>
/* Estilos del navbar específicos para esta versión limpia */
.navbar-custom {
    background: linear-gradient(135deg, #ffc0cb 0%, #ffb3d1 100%);
    box-shadow: 0 4px 15px rgba(252, 105, 152, 0.3);
    padding: 10px 0;
    position: sticky;
    top: 0;
    z-index: 1050;
    backdrop-filter: blur(10px);
}

.navbar-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
}

.navbar-brand-custom {
    display: flex;
    align-items: center;
    text-decoration: none;
    transition: transform 0.3s ease;
}

.navbar-brand-custom:hover {
    transform: scale(1.05);
}

.navbar-brand-custom img {
    height: clamp(50px, 8vw, 80px);
    width: auto;
    max-width: 250px;
}

.navbar-toggle {
    display: none;
    background: none;
    border: none;
    font-size: 1.8rem;
    color: #4e4032;
    cursor: pointer;
    padding: 8px;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.navbar-toggle:hover {
    background-color: rgba(78, 64, 50, 0.1);
    transform: scale(1.1);
}

.navbar-nav-custom {
    display: flex;
    align-items: center;
    list-style: none;
    margin: 0;
    padding: 0;
    gap: 15px;
}

.nav-item-custom {
    position: relative;
}

.nav-link-custom {
    font-family: "Dunkin", Arial, sans-serif;
    color: #4e4032;
    text-decoration: none;
    font-size: clamp(0.9rem, 1.5vw, 1.1rem);
    font-weight: 600;
    padding: 12px 16px;
    border-radius: 25px;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 5px;
    white-space: nowrap;
    cursor: pointer;
    border: none;
    background: none;
}

.nav-link-custom:hover {
    background-color: rgba(255, 255, 255, 0.8);
    color: #fc6998;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(252, 105, 152, 0.2);
    text-decoration: none;
}

.dropdown-custom {
    position: relative;
}

.dropdown-menu-custom {
    position: absolute;
    top: 100%;
    right: 0;
    background: white;
    border-radius: 15px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    min-width: 200px;
    padding: 10px 0;
    margin-top: 5px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s ease;
    z-index: 1000;
}

.dropdown-custom:hover .dropdown-menu-custom {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.dropdown-item-custom {
    display: block;
    padding: 12px 20px;
    color: #4e4032;
    text-decoration: none;
    font-family: "Dunkin", Arial, sans-serif;
    transition: all 0.3s ease;
}

.dropdown-item-custom:hover {
    background-color: #ffe5f0;
    color: #fc6998;
    text-decoration: none;
}

.dropdown-divider-custom {
    height: 1px;
    background-color: #eee;
    margin: 8px 0;
}

.profile-icon {
    width: 24px;
    height: 24px;
    margin-left: 8px;
}

/* Carrito */
.cart-container {
    position: relative;
    display: flex;
    align-items: center;
}

.carrito {
    background: linear-gradient(135deg, #fc6998, #e75480);
    border: 3px solid #4e4032;
    border-radius: 30px;
    padding: 8px 16px;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(252, 105, 152, 0.3);
    position: relative;
    z-index: 1001;
}

.carrito:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(252, 105, 152, 0.4);
}

.carrito h1 {
    font-family: "Dunkin", Arial, sans-serif;
    font-size: clamp(0.7rem, 1.2vw, 0.9rem);
    color: #4e4032;
    font-weight: bold;
    margin: 0;
}

.carrito img {
    width: 20px;
    height: 20px;
    transition: transform 0.3s ease;
}

.carrito:hover img {
    transform: rotate(10deg) scale(1.1);
}

.count-products {
    position: absolute;
    top: -8px;
    right: -8px;
    background-color: #4e4032;
    color: #ffc0cb;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    font-weight: bold;
    z-index: 1002;
    font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
}

.container-cart-products {
    position: absolute;
    top: calc(100% + 15px);
    right: 0;
    background: white;
    border: 4px solid #ffc0cb;
    border-radius: 25px;
    width: clamp(320px, 45vw, 480px);
    max-height: 85vh;
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
    z-index: 1000;
    display: none;
    overflow: hidden;
    color: #4e4032;
    font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
}

.container-cart-products.visible {
    display: block;
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.row-product {
    max-height: 400px;
    overflow-y: auto;
    padding: 20px;
}

.container-general {
    border-top: 2px solid #ffc0cb;
    padding: 20px;
    text-align: center;
}

.cart-total {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.cart-total h3 {
    font-family: "Dunkin", Arial, sans-serif;
    color: #4e4032;
    margin: 0;
}

.total-pagar {
    font-family: "Dunkin", Arial, sans-serif;
    font-size: 1.2rem;
    font-weight: bold;
    color: #fc6998;
}

.botonPagar {
    background: linear-gradient(135deg, #4e4032, #695450);
    color: #ffc0cb;
    border: 2px solid #695450;
    border-radius: 50px;
    padding: 12px 25px;
    font-family: "Dunkin", Arial, sans-serif;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    width: 100%;
}

.botonPagar:hover {
    background: linear-gradient(135deg, #ffc0cb, #ffb3d1);
    color: #695450;
    transform: scale(1.05);
}

/* Navegación móvil */
.mobile-nav {
    position: fixed;
    top: 0;
    left: -100%;
    width: 280px;
    height: 100vh;
    background: linear-gradient(135deg, #ffc0cb, #ffb3d1);
    z-index: 9999;
    transition: left 0.3s ease;
    padding-top: 60px;
}

.mobile-nav.active {
    left: 0;
}

.mobile-nav-item {
    margin-bottom: 10px;
}

.mobile-nav-link {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px 25px;
    color: #4e4032;
    text-decoration: none;
    font-family: "Dunkin", Arial, sans-serif;
    font-weight: 600;
    transition: all 0.3s ease;
}

.mobile-nav-link:hover {
    background-color: rgba(255, 255, 255, 0.3);
    color: #fc6998;
    text-decoration: none;
}

.mobile-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 9998;
    display: none;
}

.mobile-overlay.active {
    display: block;
}

/* Media Queries */
@media (max-width: 768px) {
    .navbar-toggle {
        display: block;
    }
    
    .navbar-nav-custom {
        display: none;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('Navbar limpio cargado');
    
    // Toggle del menú móvil
    const navbarToggle = document.getElementById('navbarToggle');
    const mobileNav = document.getElementById('mobileNav');
    const mobileOverlay = document.getElementById('mobileOverlay');
    
    if (navbarToggle) {
        navbarToggle.addEventListener('click', function() {
            console.log('Toggle móvil clickeado');
            mobileNav.classList.toggle('active');
            mobileOverlay.classList.toggle('active');
        });
    }
    
    if (mobileOverlay) {
        mobileOverlay.addEventListener('click', function() {
            mobileNav.classList.remove('active');
            mobileOverlay.classList.remove('active');
        });
    }
    
    // Funcionalidad del carrito
    const carritoBtn = document.getElementById('carrito');
    const containerCartProducts = document.getElementById('container-cart-products');
    
    if (carritoBtn) {
        carritoBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            console.log('Carrito clickeado');
            containerCartProducts.classList.toggle('visible');
        });
    }
    
    // Cerrar carrito al hacer click fuera
    document.addEventListener('click', function(e) {
        if (!carritoBtn.contains(e.target) && !containerCartProducts.contains(e.target)) {
            containerCartProducts.classList.remove('visible');
        }
    });
    
    // Botón pagar - redirigir a página de pago
    const btnPagar = document.getElementById('btn-pagar');
    if (btnPagar) {
        btnPagar.addEventListener('click', function() {
            console.log('Botón pagar clickeado desde navbar');
            window.location.href = '/pago/';
        });
    }
    
    // Cargar carrito desde localStorage
    function actualizarCarrito() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const contadorElement = document.getElementById('contador-productos-numero');
        const totalElement = document.getElementById('total-pagar');
        const rowProduct = document.getElementById('row-product');
        
        if (contadorElement) {
            contadorElement.textContent = cart.reduce((total, item) => total + item.quantity, 0);
        }
        
        if (cart.length === 0) {
            if (rowProduct) {
                rowProduct.innerHTML = `
                    <div class="cart-empty" style="text-align: center; padding: 40px 20px; color: #695450;">
                        <i class="fas fa-shopping-cart" style="font-size: 3rem; color: #fc6998; margin-bottom: 20px;"></i>
                        <h5 style="font-family: 'Dunkin', Arial, sans-serif; color: #4e4032; margin-bottom: 15px;">Tu carrito está vacío</h5>
                        <p>Agrega algunos productos deliciosos</p>
                    </div>
                `;
            }
            if (totalElement) {
                totalElement.textContent = '$0.00';
            }
            return;
        }
        
        let total = 0;
        let productosHTML = '';
        
        cart.forEach((item, index) => {
            const itemTotal = item.precio * item.quantity;
            total += itemTotal;
            
            productosHTML += `
                <div class="cart-product">
                    <div class="info-cart-product">
                        <span class="titulo-producto-carrito">${item.titulo}</span>
                        <span class="precio-producto-carrito">$${item.precio.toFixed(2)}</span>
                        <div class="detalles-producto-carrito">
                            ${item.masa ? `<small>Masa: ${item.masa}</small>` : ''}
                            ${item.relleno ? `<small>Relleno: ${item.relleno}</small>` : ''}
                            ${item.cubierta ? `<small>Cubierta: ${item.cubierta}</small>` : ''}
                        </div>
                    </div>
                    <div class="bottonesx2">
                        <div class="acciones-producto-carrito">
                            <button class="icon-btn" onclick="cambiarCantidad(${index}, -1)">-</button>
                            <span>${item.quantity}</span>
                            <button class="icon-btn" onclick="cambiarCantidad(${index}, 1)">+</button>
                        </div>
                        <button class="icon-btn icon-trash" onclick="eliminarProducto(${index})">🗑️</button>
                    </div>
                </div>
            `;
        });
        
        if (rowProduct) {
            rowProduct.innerHTML = productosHTML;
        }
        if (totalElement) {
            totalElement.textContent = `$${total.toFixed(2)}`;
        }
    }
    
    // Funciones globales para el carrito
    window.cambiarCantidad = function(index, change) {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        if (cart[index]) {
            cart[index].quantity += change;
            if (cart[index].quantity <= 0) {
                cart.splice(index, 1);
            }
            localStorage.setItem('cart', JSON.stringify(cart));
            actualizarCarrito();
        }
    };
    
    window.eliminarProducto = function(index) {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        cart.splice(index, 1);
        localStorage.setItem('cart', JSON.stringify(cart));
        actualizarCarrito();
    };
    
    // Actualizar carrito al cargar
    actualizarCarrito();
    
    // Escuchar cambios en el carrito
    window.addEventListener('storage', function(e) {
        if (e.key === 'cart') {
            actualizarCarrito();
        }
    });
});
</script>
